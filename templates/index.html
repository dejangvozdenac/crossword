{% extends "layout.html" %}

{% block main %}
  <center><h1>Crossword Puzzle</h1></center>
  <div id="wrap">
    <!-- across questions -->
    {% include 'index_across_questions.html' %}

    <div class="colgut">
      <!-- the crossword image -->
      {% include 'index_crossword_grid.html' %}

      <!-- submission form and buttons -->
      {% include 'index_form.html' %}
    </div>

    <!-- down questions -->
    {% include 'index_down_questions.html' %}
  </div>

  <script>
    document.getElementById('wrapper').style.height = 30 * {{ state.height }} + "px";
    document.getElementById('wrapper').style.width = 30 * {{ state.width }} + "px";
    
    {% for row in range(0, state.width) %}
      {% for col in range(0, state.height) %}
        {% if state.array[row][col].variety != "BLACK" %}
          localStorage.setItem("v_" + {{ row }} + "_" + {{ col }} , {{ state.ver_clues[row][col] }} );
          localStorage.setItem("h_" + {{ row }} + "_" + {{ col }} , {{ state.hor_clues[row][col] }} );
        {% endif %}
      {% endfor %}
    {% endfor %}

    $(document).click(function(event) {      
      var clueObj = event.target;

      if ($(clueObj)["0"].className == "empty" || $(clueObj)["0"].className == "empty numbered" || $(clueObj)["0"].className == "letter" || $(clueObj)["0"].className == "circle") {
        
        if (event.shiftKey) {
          if ($(clueObj)["0"].className == "letter"){
            clueObj = clueObj.parentNode;
          }
          console.log($(clueObj).css("background") == "rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box");
          if ($(clueObj).css("background") == "rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box") {
            $(clueObj).css("background", "LightGray");
          } else {
            $(clueObj).css("background", "rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box");
          }
          return;
        }

        y = Math.floor((event.pageX - document.getElementById('wrapper').getBoundingClientRect().left + 1) / 30)
        x = Math.floor((event.pageY - document.getElementById('wrapper').getBoundingClientRect().top + 1) / 30)
        x_order = localStorage.getItem("h_" + x + "_" + y)
        y_order = localStorage.getItem("v_" + x + "_" + y)
        acrossObj = document.getElementById('across_hidden').getElementsByTagName("div")[x_order]
        downObj   = document.getElementById('down_hidden').getElementsByTagName("div")[y_order]
        if ($("#clueText").val() == $(acrossObj).text().split(".")[0] + " " + acrossObj.parentNode.getElementsByTagName("h2")[0].innerHTML[0]) {
          clueObj = downObj
        } else {
          clueObj = acrossObj
        }
      } 
      var text = $(clueObj).text();
      var clueNumber = text.split(".")[0];
      var direction = clueObj.parentNode.getElementsByTagName("h2")[0].innerHTML;

      $("#clueText").val(clueNumber + " " + direction[0]);
      $("#clueText").css("color", "red");
      $("#solutionText").focus();
    });
  </script>
{% endblock %}