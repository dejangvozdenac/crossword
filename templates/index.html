{% extends "layout.html" %}

{% block main %}
  <center><h1>Crossword Puzzle</h1></center>
  <div id="wrap">
    <div id="across" class="col">
      <!-- questions -->
      <h2>Across</h2>
      {% for clue in cluesAcross %}
          {% if not clue.finished %}
            <div>{{ clue.number ~ ". " ~ clue.question }}</div>
          {% endif %}
      {% endfor %}
      {% for clue in cluesAcross %}
          {% if clue.finished %}
            <div style="text-decoration: line-through">{{ clue.number ~ ". " ~ clue.question }}</div>
          {% endif %}
      {% endfor %}
    </div>

    <div id="across_hidden" hidden class="col">
      <!-- questions -->
      <h2>Across</h2>
      {% for clue in cluesAcross %}
          <div>{{ clue.number ~ ". " ~ clue.question }}</div>
      {% endfor %}
    </div>

    <div class="colgut">
      <!-- the crossword image -->
      <div id="wrapper">
        {% for row in state.array %}
          {% for cell in row %}
            {% if cell.variety == "BLACK" %}
              <div class="filled"></div>
            {% elif cell.numbered %}
              {% if cell.variety == "WHITE_INCORRECT" %}
                {% if cell.circle == True %}
                  <div class="empty incorrect">
                    <div class = "circle"></div>
                    <div class = "numbered"></div>
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                {% else %}
                  <div class="empty numbered incorrect">
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              {% else %}
                {% if cell.circle == True %}
                  <div class="empty">
                    <div class = "circle"></div>
                    <div class = "numbered"></div>
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                  {% else %}
                    <div class="empty numbered">
                      {% if cell.letter %}
                        <div class="letter">{{ cell.letter }}</div>
                      {% endif %}
                    </div>
                  {% endif %}
              {% endif %}
            {% else %}
              {% if cell.variety == "WHITE_INCORRECT" %}
                {% if cell.circle == True %}
                  <div class="empty incorrect">
                    <div class = "circle"></div>
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                {% else %}
                  <div class="empty incorrect">
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              {% else %}
                {% if cell.circle == True %}
                  <div class="empty">
                    <div class = "circle"></div>
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                {% else %}
                  <div class="empty">
                    {% if cell.letter %}
                      <div class="letter">{{ cell.letter }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              {% endif %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      </div>

      <!-- form submission -->
      <form action="{{ url_for('command', room_name=room_name) }}" id="command" method="post">
        <div class="form-group">
          <b><label>Clue:</label></b>
          <input class="form-control" name="clue" id="clueText" placeholder="4 a"/>
        </div>

        <div class="form-group">
          <b><label>Letter position (optional):</label></b>
          <input class="form-control" name="position" placeholder="3"/>
        </div>

        <div class="form-group">
          <b><label>Solution:</label></b>
          <input class="form-control" name="solution" id="solutionText" placeholder="aria"/>
        </div>

        <div class="form-group">
          <input type="submit" name="command_type" value="Fill"></button>
          <input type="submit" name="command_type" value="Delete"></button>
          <input type="submit" name="command_type" value="Check"></button>
          <input type="submit" name="command_type" value="Uncheck"></button>
          <input type="submit" name="command_type" value="New Puzzle"></button>
          <input type="submit" name="command_type" value="Switch Room"></button>
        </div>
      </form>
    </div>

    <div id="down" class="colright">
      <!-- questions -->
      <h2>Down</h2>
      {% for clue in cluesDown %}
        {% if not clue.finished %}
          <div>{{ clue.number ~ ". " ~ clue.question }}</div>
        {% endif %}
      {% endfor %}
      {% for clue in cluesDown %}
        {% if clue.finished %}
          <div style="text-decoration: line-through">{{ clue.number ~ ". " ~ clue.question }}</div>
        {% endif %}
      {% endfor %}
    </div>

    <div id="down_hidden" hidden class="col">
      <!-- questions -->
      <h2>Down</h2>
      {% for clue in cluesDown %}
          <div>{{ clue.number ~ ". " ~ clue.question }}</div>
      {% endfor %}
    </div>

  </div>

  <script>
    document.getElementById('wrapper').style.height = 30 * {{ state.height }} + "px";
    document.getElementById('wrapper').style.width = 30 * {{ state.width }} + "px";
    
    {% for row in range(0, state.width) %}
      {% for col in range(0, state.height) %}
        {% if state.array[row][col].variety != "BLACK" %}
          localStorage.setItem("v_" + {{ row }} + "_" + {{ col }} , {{ state.ver_clues[row][col] }} );
          localStorage.setItem("h_" + {{ row }} + "_" + {{ col }} , {{ state.hor_clues[row][col] }} );
        {% endif %}
      {% endfor %}
    {% endfor %}

    $(document).click(function(event) {      
      var clueObj = event.target;

      if ($(clueObj)["0"].className == "empty" || $(clueObj)["0"].className == "empty numbered" || $(clueObj)["0"].className == "letter" || $(clueObj)["0"].className == "circle") {
        
        if (event.shiftKey) {
          if ($(clueObj)["0"].className == "letter"){
            clueObj = clueObj.parentNode;
          }
          console.log($(clueObj).css("background") == "rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box");
          if ($(clueObj).css("background") == "rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box") {
            $(clueObj).css("background", "LightGray");
          } else {
            $(clueObj).css("background", "rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box");
          }
          return;
        }

        y = Math.floor((event.pageX - document.getElementById('wrapper').getBoundingClientRect().left + 1) / 30)
        x = Math.floor((event.pageY - document.getElementById('wrapper').getBoundingClientRect().top + 1) / 30)
        x_order = localStorage.getItem("h_" + x + "_" + y)
        y_order = localStorage.getItem("v_" + x + "_" + y)
        acrossObj = document.getElementById('across_hidden').getElementsByTagName("div")[x_order]
        downObj   = document.getElementById('down_hidden').getElementsByTagName("div")[y_order]
        if ($("#clueText").val() == $(acrossObj).text().split(".")[0] + " " + acrossObj.parentNode.getElementsByTagName("h2")[0].innerHTML[0]) {
          clueObj = downObj
        } else {
          clueObj = acrossObj
        }
      } 
      var text = $(clueObj).text();
      var clueNumber = text.split(".")[0];
      var direction = clueObj.parentNode.getElementsByTagName("h2")[0].innerHTML;

      $("#clueText").val(clueNumber + " " + direction[0]);
      $("#clueText").css("color", "red");
      $("#solutionText").focus();
    });
  </script>
{% endblock %}